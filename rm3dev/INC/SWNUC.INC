;---FILE HEADER-(set tabulator to 8)-------------------------------------------
;   filename	: SWNUC.INC
;   version	: 0004
;   contents	: Nucleus software configuration expansion
;   author	: K.P.H.
;   date	: Mar 15, 1995
;
;---FUNCTION AND RMOS ENVIRONMENT----------------------------------------------
;
;   function	: some data declarations for the nucleus
;
;   RMOS2 & RMOS3
;
;---END	OF FILE	HEADER---------------------------------------------------------
;
;---MODIFICATION HEADER--------------------------------------------------------
;
;   Nov 23, 1994 K.P.H. 0001	Original issue
;   Oct 12, 1995 K.P.H. 0002	Modification for RMOS V3.12
;   Mar 15, 1996 K.P.H. 0003	Additional modification for RMOS V3.12
;   Jul 17, 2001 B.N.   0004	Additional modification for RMOS V3.30
;
;---END	OF MODIFICATION	HEADER-------------------------------------------------


;   SYSTEM PARAMETERS.

X_MAILBOX_DYN_NUM  	EQU	255	;1.. 255: NO OF	DYN. MAILBOXES
X_GEF_DYN_NUM	   	EQU	63+64	;1.. 127: NO OF	DYN. GLOBAL EVENT FLAG GROUP
X_SEMA_DYN_NUM	  	EQU	1023	;1..4095: NO OF	DYN. SEMAPHORES

X_DISCRETE_DYN_NUM	EQU	32	;1..4095: NO OF	DYN. DISCRETE BYTES
X_MEM_POOL_DYN_NUM	EQU	8	;1..   8: NO OF	DYN. MEMORY POOLS 
X_MEM_POOL_LAST		EQU 	(X_MEM_POOL_DYN_NUM-1) * MPB_SIZE ;LAST MEM POOL

X_CONTROL_NUM		EQU	32	;1.. 256: NO OF	CONTROLLED PROGRAMS
X_SRB_NUM		EQU	120	;32..	  NO OF	SCHEDULER REQUEST BLOCKS

X_TASK_NUM	  	EQU	200	;50..	  NO OF	SYSTEM MEMORY BLOCKS
					;(SMR'S). ONLY STARTUP VALUE. THE VALUE
					;IS INCREASED IF NECESSARY TO THE
					;BOUNDARY SET WITH SVC RmSetSMRCount
X_STACK_SIZE	  	EQU	1024	;800..	  SIZE OF SYSTEM STACK OF WORDS
X_VECTORS_NUM	  	EQU	16	;DUMMY FOR OLD DRIVERS
	PUBLIC	X_VECTORS_NUM


%RCODE_SEG_NG

	PUBLIC	X_USER_TABLE_CODE
X_USER_TABLE_CODE	LABEL	DWORD	;START OF USER DATA
	DD	0
USER_NUM_C    EQU ($-X_USER_TABLE_CODE) / (TYPE X_USER_TABLE_CODE)

	PUBLIC  X_NUCSEG
	PUBLIC  X_DATASEG
	
X_NUCSEG	DW	%RCODE
X_DATASEG	DW	%RDATA

;   MEMORY-REQUIRED TABLE:
;
;   THE	BYTES IN THIS TABLE CORRESPOND TO THE SERVICES IN NUMERICAL ORDER.
;   A VALUE OF 0 INDICATES NO MEMORY REQUIRED; A VALUE OF 1 INDICATES THAT
;   THE	SERVICE	ROUTINE	CALLS X_GET_SMR	AT LEAST ONCE.

	PUBLIC  X_MEM_RQRD

X_MEM_RQRD	LABEL	BYTE
	DB	0		;DUMMY NEEDS NOTHING.
	DB	2,2		;STRT AND QSTRT	MAY NEED 2 EACH.
	DB	0,1		;ENDT NEEDS NOTHING; ENDR NEEDS	ONE.
	DB	0,1,0		;ONLY PAUSE FROM THE CONTROL GROUP.
	DB	0,0,0,1 	;SEFET FROM THE FLAGS GROUP.
	DB	2	 	;WEF FROM THE FLAGS GROUP(+TIMEOUT).
	DB	2,2		;MAILBOXING USES SMR COMING AND	GOING(+TIMEOUT)
	DB	1,0		;ALOC MAY NEED ONE; DALOC NEVER.
	DB	2		;CNTRL NEEDS 2.
	DB	0,0		;TIME OF DAY USES NOTHING.
	DB	0,2		;DSCRTE	NEEDS NONE, RIO	NEEDS 2.
	DB	0,2		;RESET NEEDS NONE, TEST/SET NEEDS 2
	DB	1  		;QCOPY NEEDS ONE.
	DB	1		;DBGSVC	MAY NEED ONE.
	DB	3,0,0		;CREATE NEEDS 3, DELETE NEEDS NONE.
	DB	0  		;SET_SVC NEEDS NONE.
	DB	1		;RESERVED FOR THE HSFS SVC
	DB	0		;RESOURCE REPORTER NEEDS NONE.
	DB	0,0		;GET_TABLES, RESERVED NEEDS NONE
	DB	16 DUP(0)	;CATALOG TIL DELETESEMA NEEDS NONE.
	DB	2		;LOOK MAYBE NEEDS ONE(+TIMEOUT).
	DB	0  		;SETINT NEEDS NONE.
	DB	0,0,0,0,0	;RESERVED.
	DB	0,0		;LINK_TIMER_ROUTINE, UNLINK_TIMER_ROUTINE NEEDS	NONE
	DB	0		;LIST NEEDS NONE.
	DB	0		;UNCATALOG NEEDS NONE.
	DB	0  		;LOCKS NEEDS NONE.
	DB	2		;TIMEOUT MAYBE NEEDS TWO.
	DB	0		;CREATEHPOOL NEEDS NONE.
	DB	2		;HALOC MAYBE NEEDS TWO(ALSO FOR TIMEOUT).
	DB	0		;GETSIZE NEEDS NONE.
	DB	2,2,2,2,2 	;RESERVED(EFS, NOTHING)
	DB	0		;KILLTSK NEEDS NONE.
	DB	0		;HDALOC	NEEDS NONE.
	DB	2		;TIMERSTART NEEDS 2.
	DB	0  		;TIMERCANCEL NEEDS NONE.
	DB	0		;BOUND NEEDS NONE.
	DB	0		;INTRHAND NEEDS	NONE
	DB	11 DUP(0)	;INIT_OS TIL GET_SYSB NEEDS NONE.
	DB	4  DUP(0)	;TIME CALLS NEEDS NONE.
	DB	8  DUP(0)	;RmGetName TIL RmGetTaskID NEEDS NONE.
	DB	1		;RmActivateTask
	DB	0		;RmSuspendTask
	DB	3		;RmCreateTask
	DB	6  DUP(0)	;RmSetLocalFlag TIL RmSegtoFlat NEEDS NONE.
	DB	2  		;RmRealloc
	DB	0  		;RmFreeAll
	DB	2  		;RmMemPoolAlloc
	DB	2  DUP(0)	;CreateMessageQueue, DeleteMessageQueue
	DB	2  DUP(2)	;SendMessage, ReceiveMessage
	DB	0  		;SetMessageQueueSize

	DB	MAX_SVC_NUM+16-($-X_MEM_RQRD) DUP(2) ;RESERVE SOME
;EVEN

	PUBLIC  XMTOSDS, XMTOSGROM, XVERSION
	PUBLIC	X_C_MAILBOX_DYN_NUM
	PUBLIC	X_C_GEF_DYN_NUM
	PUBLIC	X_C_SEMA_DYN_NUM
	PUBLIC	X_C_TASK_NUM
	PUBLIC	X_C_MEM_POOL_DYN_NUM
	PUBLIC	X_C_SYSTEM_DATA
	PUBLIC	X_C_USER_NUM_CODE
	PUBLIC	X_C_USER_NUM_DATA

XMTOSDS		DW	%RDATA	;FOR HLL
XMTOSGROM	DW	%RCCODE
XVERSION	DW	0403H	;VERSION NUMBER OF NUCLEUS

X_C_MAILBOX_DYN_NUM	DW  X_MAILBOX_DYN_NUM
X_C_GEF_DYN_NUM		DW  X_GEF_DYN_NUM	 
X_C_SEMA_DYN_NUM	DW  X_SEMA_DYN_NUM	 
X_C_TASK_NUM		DW  X_TASK_NUM	 
X_C_MEM_POOL_DYN_NUM	DW  X_MEM_POOL_DYN_NUM	 
X_C_SYSTEM_DATA		DW  X_SYSTEM_DATA
X_C_USER_NUM_CODE	DW  USER_NUM_C
X_C_USER_NUM_DATA	DW  USER_NUM_D

;   ADDRESSES OF SOME INTERNAL ERROR MESSAGES:

	PUBLIC  X_NO_SMR_MSG
	PUBLIC  X_NO_SMR_WARN
	PUBLIC  X_NO_SMR_INCR
	PUBLIC  X_MSG_SRB_OUT
	PUBLIC  X_WR_TASK_ID


X_NO_SMR_MSG	DB	13,10,'*** nuc: ',25H,'s, no SMRS, SYSTEM HALTED.',0
X_NO_SMR_WARN	DB	13,10,'*** nuc: ',25H,'s, SMRS reached 0',0
X_NO_SMR_INCR	DB	13,10,'*** nuc: ',25H,'s, SMRS increased',0
X_MSG_SRB_OUT	DB	13,10,'*** nuc: ',25H,'s, no SRBS, SYSTEM HALTED.',0
X_WR_TASK_ID	DB	13,10,'*** nuc: wrong task-id',0

%END_RCODE_SEG

;   HERE ARE DEFINED ALL THE SYSTEM'S RAM DATA STRUCTURES
;
;   RAM	PUBLICS:

	PUBLIC  X_MESSAGE_TCB
	PUBLIC	X_REALLOC_PTR
	PUBLIC	X_REALLOC_LEN
	PUBLIC  X_MESSAGE
	PUBLIC  X_DRIVER_DYN_NUM
	PUBLIC  X_UNIT_DYN_NUM
	PUBLIC  X_CONTROL_NUM
	PUBLIC  X_SRB_NUM
	PUBLIC  X_TASK_NUM
	PUBLIC  X_TASK_MAX
	PUBLIC  X_DISCRETE_DYN_NUM
	PUBLIC  X_MEM_POOL_DYN_NUM
	PUBLIC  X_MEM_POOL_LAST
	PUBLIC  X_MAILBOX_DYN_NUM
	PUBLIC  X_GEF_DYN_NUM
	PUBLIC  X_SEMA_DYN_NUM
%IF(%RM3)THEN(
	PUBLIC  X_PROC_CR_INHERITANCE
	PUBLIC  X_PROC_CR_REMOVE_INHERITANCE
	PUBLIC  X_PROC_CR_ENDTASK
	PUBLIC  X_PROC_CR_DELETETASK
	PUBLIC  X_PROC_CR_KILLTASK
	PUBLIC  X_PROC_CLI_KILLTASK
	PUBLIC  X_PROC_DEB_DB_CONT
)FI
	PUBLIC  X_SYSB
	PUBLIC  X_NUCTRACE
	PUBLIC  X_SAVEHWINT
	PUBLIC  X_TIMESTRCT
	PUBLIC  X_RES_VECTORS
	PUBLIC  X_DECODE_FN
	PUBLIC  X_SEC_DEC
	PUBLIC  X_EXCTYPE
	PUBLIC  X_CSYS_DEVICE
	PUBLIC  X_CSYS_UNIT
	PUBLIC	X_C_TASK_EXCOUT
	PUBLIC	X_C_TASK_EXCOUT_PRI
	PUBLIC  X_C_TASK_DEB	  	;DEBUGGER ID FOR EXCEPTION HANDLER EXCOUT
	PUBLIC  X_C_REP_DEVICE   
	PUBLIC  X_C_REP_UNIT	  
	PUBLIC  X_C_REP_TABLE_SIZE	
	PUBLIC  X_CFGSTATE
	PUBLIC  X_ERRSTATE
	PUBLIC  X_DYN_JT  
	PUBLIC  X_PIT_INT_TAB 
	PUBLIC  X_TASK_TCB_STAT
	PUBLIC  X_TASK_ID_STAT
	PUBLIC  X_DOS_INTR		;ONLY FOR RMOS2
	PUBLIC	X_HEAP_ID		;ONLY A DUMMY FOR BK-DRIVER
	PUBLIC	X_TIMEOUT_VALUE
	PUBLIC  X_SYSTEM_TABLE
;	PUBLIC  X_FLAT_DESC
	PUBLIC  X_TRAP_ADR
	PUBLIC  X_ACT_BPB
	PUBLIC  X_DATA_START
	PUBLIC  XCSRB
	PUBLIC  X_ATCB
	PUBLIC  X_TASK_EIPCS
	PUBLIC  X_CTCB
	PUBLIC  X_S_STATE
	PUBLIC  X_TOGGLE
	PUBLIC	X_READY_FLAG
	PUBLIC  X_STACKSTART
	PUBLIC  X_STACKSTART_MON
	PUBLIC  XMSS
	PUBLIC  XMSP
	PUBLIC  X_INTLEVEL
	PUBLIC  X_INH_LOC
	PUBLIC  X_RR_ACT
	PUBLIC  X_RR_BOUND
	PUBLIC  X_DRIVER_SAVE
	PUBLIC  X_DRIVER_SIZE
	PUBLIC  XCIRB
	PUBLIC  XDCB
	PUBLIC  XUCB
	PUBLIC  XDEVNUM
	PUBLIC  XDEVUNIT
	PUBLIC  XTUNIT
	PUBLIC  XTNUM
	PUBLIC  XPOINTER
	PUBLIC  XOFFSET 
	PUBLIC  XSEGMENT
	PUBLIC  XSTATUS
	PUBLIC  XERRMSG
	PUBLIC  XPOOLNUM
	PUBLIC  XBLKLEN
	PUBLIC  XTASK
	PUBLIC  XPRIS
	PUBLIC  XPRIV
	PUBLIC  XP1
	PUBLIC  XP2
	PUBLIC  XGRP
	PUBLIC  XFLAGS
	PUBLIC  XBOX
	PUBLIC  XGENB
	PUBLIC  XGENW
	PUBLIC  X_CSVC

	PUBLIC  XGEND, XSEG, XSEGLIM
	PUBLIC  XMONMOD, X_INIT_EXT

	PUBLIC  X_TCB_TABLE
	PUBLIC  X_FREEUCDPTR
	PUBLIC  X_FREEUCD
	PUBLIC  X_FREEUCBPTR
	PUBLIC  X_FREEUCB

	PUBLIC  X_CP_TABLE
	PUBLIC  X_DCB_Q
	PUBLIC  X_SMR_Q
	PUBLIC  X_SMR_I
	PUBLIC  X_SMR_LIST
	PUBLIC  X_SMR_LAST
	PUBLIC  X_SRB_START
	PUBLIC  X_SRB_FREEQ
	PUBLIC  X_SRB_AVAIL
	PUBLIC  X_SRB_Q
	PUBLIC  X_SRB_QEND
	PUBLIC  X_TMB_Q
	PUBLIC  X_ASCTOD
	PUBLIC  X_TOD_TMB
	PUBLIC  X_ABS_TIME
	PUBLIC  X_LREADY_Q
	PUBLIC  X_BREAK_Q
	PUBLIC  X_MPDD_TABLE
	PUBLIC  X_MPBD_TABLE
	PUBLIC  X_SCBD_TABLE
	PUBLIC  X_MBXD_TABLE
	PUBLIC  X_GEFD_TABLE
	PUBLIC  X_DDDD_TABLE
	PUBLIC  X_DIR_TABLE
	PUBLIC  X_DIR_WAITQ
	PUBLIC  X_GINIT_SIZE
	PUBLIC  X_TIB_Q
	PUBLIC  X_TIB_COUNTER
	PUBLIC  X_S_TCB
	PUBLIC  X_3964_DEVICE
%IF (%RM3) THEN (%'
	PUBLIC  X_FLAT_ER_SEL
	PUBLIC  X_FLAT_RW_SEL
	PUBLIC  X_STACKLOW_PHYS
	PUBLIC  X_FREE_SLOT
	PUBLIC  X_INT07_MEM
	PUBLIC  X_INT13_MEM
) ELSE (%'
	PUBLIC	X_HOOK_TAB
	PUBLIC  X_DATA_LEN		;ONLY FOR RMOS2
) FI%'

;   SYSTEM STACK

%RDATA_SEG_NG

;   SYSTEM STACK: USED FOR ALL S-STATE AND INTERRUPT LEVEL PROCESSING.

%IF (%RM3) THEN (%'
		DD	X_STACK_SIZE DUP (?)
X_STACKSTART	EQU THIS DWORD

;   MONITOR STACK: USED	FOR ALL	S-STATE	AND INTERRUPT LEVEL PROCESSING.

		DD	X_STACK_SIZE DUP (?)
X_STACKSTART_MON	EQU	THIS DWORD
) ELSE (%'
		DW	X_STACK_SIZE DUP (?)
X_STACKSTART	EQU THIS DWORD

;   MONITOR STACK: USED	FOR ALL	S-STATE	AND INTERRUPT LEVEL PROCESSING.

		DW	X_STACK_SIZE DUP (?)
X_STACKSTART_MON	EQU	THIS DWORD
) FI%'

;   RAM	STRUCTURES.
;
;   THE	STRUCTURES DEFINED IN THIS SECTION ARE ALL REQUIRED TO BE IN
;   RAM. THEIR SIZES ALL FLOW FROM THE DEFINITIONS OF
;   THE	SYSTEM PARAMETERS ABOVE.

X_DATA_START	LABEL	DWORD	;START OF SYSTEM DATA

;   FIRST, THE TABULAR STRUCTURES:

X_TCB_TABLE	LABEL	DWORD
		DB	X_TASK_NUM * SMR_SIZE  DUP (?)

X_GEFD_TABLE	LABEL	DWORD
		DB	X_GEF_DYN_NUM * EFG_SIZE  DUP (?)

X_SCBD_TABLE	LABEL	DWORD
		DB	X_SEMA_DYN_NUM * SEM_SIZE  DUP (?)
		DW	?	;ALIGN
	   
X_MBXD_TABLE	LABEL	DWORD
		DB	X_MAILBOX_DYN_NUM * MBX_SIZE  DUP (?)
	   
X_MPDD_TABLE	LABEL	DWORD
		DB	X_MEM_POOL_DYN_NUM * MPD_SIZE  DUP (?)

X_MPBD_TABLE	LABEL	DWORD
		DB	X_MEM_POOL_DYN_NUM * MPB_SIZE  DUP (?)

X_CP_TABLE	LABEL	DWORD
		DB	X_CONTROL_NUM * SEM_SIZE  DUP (?)
	   
X_DDDD_TABLE	LABEL	DWORD
		DB	X_DISCRETE_DYN_NUM * DDD_SIZE  DUP (?)

X_SRB_START 	DB  X_SRB_NUM * SRB_SIZE DUP (?)
X_DIR_TABLE 	DB	%IF(%RM3)THEN(694)ELSE(574)FI DUP(?)	;SIZE OF DIR_DESC ( SEE: EQUS.H )
		DW	?	;ALIGN


X_SYSTEM_TABLE	LABEL	DWORD	;START OF GENERAL SYSTEM DATA
%IF (%RM3) THEN (%'
X_ABS_TIME	DQ	?		;ABSOLUTE SYSTEM TIME, MSEC. (INTEL FORMAT)
X_DIR_WAITQ 	DD	?   		;HEADER OF DIRECTORY WAIT QUEUE.
X_TMB_Q		DD	?		;HEAD OF ACTIVE TMB QUEUE.
X_BREAK_Q	DD	?		;BREAKPOINT	QUEUE HEAD
X_DCB_Q		DD	?		;HEAD OF DCB QUEUE.
X_TIB_Q		DD	?		;HEAD OF TIB QUEUE
X_LREADY_Q	DD	?		;READY QUEUE HEAD.

X_SMR_LIST	DD	?		;HEAD OF SMR FREE LIST.

X_SMR_LAST	DD	?		;LAST SMR. THE LAST SMR IS CONNECTED
					;WITH SMR_LINK TO NEW ONES WHEN
					;SMRS ARE INCREASED

X_SRB_AVAIL	DD	?		;COUNT OF FREE SRBS.

X_INIT_EXT	DD	?		;FOR INITIALIZATION

X_FLAT_ER_SEL	DW	?		;FLAT CODE SELECTOR
X_FLAT_RW_SEL	DW	?		;FLAT DATA SELECTOR

X_TASK_TCB_STAT	DD	?
X_TASK_ID_STAT	DD	?
X_TASK_MAX	DD	?		;MAX TASK NUMBERS.
X_RR_ACT	DW	?		;TICKS REMAINING IN ROUND-ROBIN	COUNT.
X_RR_BOUND	DW	?		;ROUND	ROBIN COUNTER (0=OFF)
X_INT07_MEM	DQ	?		;FOR THE INT07 NUCLEUS HANDLER
X_INT13_MEM	DQ	?		;FOR THE INT13 NUCLEUS HANDLER
X_FREE_SLOT	DW	?		;FIRST FREE	SLOT IN	THE GDT
X_REALLOC_LEN	DD	?		;REALLOC LEN
X_REALLOC_PTR	DP	?		;REALLOC PTR
					;ALSO USED BY RM_SET_DEV_HANDLER AS EXTRA STORAGE
X_DRIVER_DYN_NUM DB	?
X_UNIT_DYN_NUM	DB	?
X_CFGSTATE	DW	?		;CONFIGURATION STATE

X_DECODE_FN	DP	?		;POINTER TO LIST OF EXTRA DECODE FUNCTIONS
X_SEC_DEC	DP	?		;POINTER TO LIST OF SECTION DECODE FUNCTIONS
X_ERRSTATE	DW	?		;ERROR STATE
X_EXCTYPE	DB	?
		DB	?
X_MESSAGE_TCB 	DD	?
X_MESSAGE	DD	3 DUP(?)

X_CSYS_DEVICE	DW	?
X_CSYS_UNIT	DW	?
X_C_TASK_DEB	DD	?		;DEBUGGER ID FOR EXCEPTION HANDLER EXCOUT
X_C_TASK_EXCOUT	DW	?		;ID OF EXCEPTION HANDLER EXCOUT TASK
X_C_TASK_EXCOUT_PRI DW	?		;PRIORITY OF EXCEPTION HANDLER EXCOUT TASK
X_PIT_INT_TAB	DQ  5 DUP(?)		;TIMER LINK TABLE
X_SYSTEM_DATA	EQU $ -	X_SYSTEM_TABLE	;GENERAL DATA LENGTH.

X_NUCTRACE	DD	?		;RESERVED
X_SYSB		DB  SIZE SYSB_S DUP(?)	;SYSTEM CONTROL BLOCK
		DW	?		;ALIGN

X_PROC_CR_INHERITANCE		DP	?
				DW	?
X_PROC_CR_REMOVE_INHERITANCE	DP	?
				DW	?
X_PROC_CR_ENDTASK		DP	?
				DW	?
X_PROC_CR_DELETETASK		DP	?
				DW	?
X_PROC_CR_KILLTASK		DP	?
				DW	?
X_PROC_CLI_KILLTASK		DP	?
				DW	?
X_PROC_DEB_DB_CONT		DP	?
				DW	?

;   SYSTEM STATE-TRACKING VARIABLES:

XCSRB		DQ	?		;CURRENT SRB
X_ATCB		DD	?		;ACTIVE TASK'S TCB OFFSET
X_TASK_EIPCS	DQ	?		;EIP/CS	AT WHICH THE LAST TASK WAS LAST
					;SCHEDULED (REQUIRED BY	DEBUGGER FOR
					;BREAKPOINT CONTROL).
X_TRAP_ADR	DD	?		;SAVED PHYSICAL TRAP POINT ADR.
X_ACT_BPB	DD	?		;ACTUAL BREAK POINT BLOCK OFFSET
X_S_STATE	DD	?		;JUMP POINTER FOR SCHEDULER.
X_INH_LOC	DD	?		;INHIBIT INDICATOR

X_HEAP_ID	DD	?		;CONFIGURED/DEFINED HEAP ID (ONLY DUMMY)
X_TIMEOUT_VALUE	DD	?		;TIMEOUT VALUE
X_ASCTOD	DQ	?		;ASCII TIME OF DAY.
X_INTLEVEL	DW	?		;CURRENT INTERRUPT NESTING LEVEL.
X_3964_DEVICE	DB	?		;FOR 3964 DRIVER
XMONMOD		DB	?		;DEBUGGER MONITOR MODE INDICATOR
X_FREEUCDPTR	DD	?		;POINTER TO FREE UCD FROM XALLOC_UCD
X_FREEUCD	DW	?		;NUMBER OF FREE UCDs IN X_FREEUCDPTR
X_FREEUCB	DW	?		;NUMBER OF FREE UCBs IN X_FREEUCDPTR
X_FREEUCBPTR	DD	?		;POINTER TO FREE UCB FROM XALLOC_UCB
X_TIB_COUNTER	DD	?		;CONSECUTIVE COUNTER FOR TIB ID
RESERV_3	DW	?
XMSS		DW	?
XMSP		DD	?

;X_FLAT_DESC	DW	?		;FLAT MEMORY DESCRIPTOR
;		DW	?
X_S_TCB		DB  SMR_SIZE DUP (?)	;FOR DUMMY TCB
					;X_S_STK MUST LIE BEHIND X_S_TCB
X_S_STK		DD  4 DUP (?)		;STK_EAX, STK_EIP, STK_CS, STK_EFL
X_TIMESTRCT	DB  8 DUP (?)		;USED FOR READING CMOS TIME AT STARTUP
X_SAVEHWINT	DB 16 DUP (?)		;STORE VM INT STATE (RMOS OR DOS INT)
X_C_REP_DEVICE	DW	?	
X_C_REP_UNIT	DW	?	
X_C_REP_TABLE_SIZE DD	?   
X_SRB_Q		DD	?		;SRB QUEUE HEADS.
X_SRB_FREEQ	DD	?		;HEAD OF SRB FREE LIST.
X_SRB_QEND	DD	?		;SRB QUEUE TAILS.
X_SMR_Q		DD	?		;HEAD OF SMR WAIT QUEUE.
X_SMR_I		DD	?		;USED SMR DURING SVC IN I-STATE
X_DYN_JT	DD  MAX_SVC_NUM DUP(?)	;DYNAMIC SVC JUMP TABLE
X_DOS_INTR	DD	?		;ONLY FOR RMOS2
X_STACKLOW_PHYS	DD	?

X_RES_VECTORS	DB  32 DUP(?)		;BITFIELD FOR SET OR RESERVED VECTORS
X_TOD_TMB	DB  TMB_SIZE DUP (?)	;TIME OF DAY TMB - DEDICATED.

;   SPECIAL VARIABLES FOR THE DEVICE DRIVERS:
;   WILL BE COPIED IN MONITOR MODE SO DONT CHANGE IT

XCIRB		DQ	?		;CURRENT IRB
X_CTCB		DD	?		;TCB OFFSET OF TASK WHICH WAS ACTIVE
	 				;WHEN CURRENT SRB WAS CONSTRUCTED.
X_READY_FLAG	DB	?		;READY_FLAG FOR SCHEDULER.
X_TOGGLE	DB	?		;TIEBREAKING TOGGLE FOR SCHEDULER.
X_CSVC		DW	?		;CURRENT SVC NUMBER.
XDCB		DQ	?		;CURRENT DCB
XUCB		DQ	?		;CURRENT UCB
XPOINTER	LABEL PWORD		;GENERAL PURPOSE POINTER VARIABLE:
XOFFSET		DD	?		;OFFSET,
XSEGMENT	DD	?		;SELECTOR.
XDEVNUM		DB	?		;CURRENT DEVICE NUMBER,
XDEVUNIT	DB	?		;CURRENT UNIT NUMBER.
XTUNIT		DB	?		;TIME-UNIT CODE.
XTNUM		DB	?		;NUMBER OF UNITS
XSTATUS		DQ	?		;STATUS TRANSPORT VARIABLE.
XERRMSG		DQ	?		;ERROR-MESSAGE TRANSPORT VARIABLE.
XPOOLNUM	DD	?		;POOL NUMBER FOR BLOCK ALLOCATION.
XBLKLEN		DD	?		;LENGTH OF BLOCK NEEDED, BYTES.
XTASK		DW	?		;TASK ID.
XPRIS		DB	?		;PRIORITY SOURCE OPTIONS.
XPRIV		DB	?		;PRIORITY.
XP1		DD	?		;PARAMETER 1.
XP2		DD	?		;PARAMETER 2.
XGRP		DD	?		;GLOGAL EVENT FLAG GROUP ID.
XFLAGS		DD	?		;EVENT FLAG	MASK.
XGENW		DW	?		;GENERAL WORD.
XBOX		DB	?		;LOCAL MAILBOX ID
XGENB		DB	?		;GENERAL BYTE.
XGEND		DD	?		;GENERAL DWORD.
XSEG		DD	?		;SELECTOR FOR S-STATE ROUTINES
XSEGLIM		DD	?		;SEGMENT LIMIT FOR S-STATE ROUTINES
X_DRIVER_SIZE	EQU $-XCIRB		;DRIVER VARIABLE LENGTH.

X_DRIVER_SAVE	DB  X_DRIVER_SIZE DUP (?)

	PUBLIC	X_USER_TABLE_DATA
X_USER_TABLE_DATA	LABEL	DWORD	;START OF USER DATA
		DD	?
USER_NUM_D    EQU ($-X_USER_TABLE_DATA) / (TYPE X_USER_TABLE_DATA)

X_GINIT_SIZE	EQU $ -	X_DATA_START	;INITIALIZATION	LENGTH.
		DD  ?			;DONT REMOVE THIS!!!!

%END_RDATA_SEG

) ELSE (%'
X_ABS_TIME	DW	3 DUP (?)	;ABSOLUTE SYSTEM TIME, MSEC. (MOTOROLA FORMAT)
X_DIR_WAITQ 	DW	?   		;HEADER OF DIRECTORY WAIT QUEUE.
X_TMB_Q		DW	?		;HEAD OF ACTIVE TMB QUEUE.
X_BREAK_Q	DW	?		;BREAKPOINT	QUEUE HEAD
X_DCB_Q		DW	?		;HEAD OF DCB QUEUE.
X_TIB_Q		DW	?		;HEAD OF TIB QUEUE
X_LREADY_Q	DW	?		;READY QUEUE HEAD.

X_SMR_LIST	DW	?		;HEAD OF SMR FREE LIST.

X_SRB_AVAIL	DW	?		;COUNT OF FREE SRBS.

X_INIT_EXT	DD	?		;FOR INITIALIZATION

X_TASK_TCB_STAT	DW	?
X_TASK_ID_STAT	DW	?
X_TASK_MAX	DW	?		;MAX TASK NUMBERS.
X_RR_ACT	DW	?		;TICKS REMAINING IN ROUND-ROBIN	COUNT.
X_RR_BOUND	DW	?		;ROUND	ROBIN COUNTER (0=OFF)
X_REALLOC_LEN	DD	?		;REALLOC LEN
X_REALLOC_PTR	DD	?		;REALLOC PTR
					;ALSO USED BY RM_SET_DEV_HANDLER AS EXTRA STORAGE
X_DRIVER_DYN_NUM DB	?
X_UNIT_DYN_NUM	DB	?
X_CFGSTATE	DW	?		;CONFIGURATION STATE

X_DECODE_FN	DD	?		;POINTER TO LIST OF EXTRA DECODE FUNCTIONS
X_SEC_DEC	DD	?		;POINTER TO LIST OF SECTION DECODE FUNCTIONS
X_ERRSTATE	DW	?		;ERROR STATE
X_EXCTYPE	DB	?
X_MESSAGE_TCB 	DW	?
X_MESSAGE	DW	3 DUP(?)

X_CSYS_DEVICE	DW	?
X_CSYS_UNIT	DW	?
X_C_TASK_DEB	DW	?		;DEBUGGER ID FOR EXCEPTION HANDLER EXCOUT
X_PIT_INT_TAB	DD  5 DUP(?)		;TIMER LINK TABLE
X_SYSTEM_DATA	EQU $ -	X_SYSTEM_TABLE	;GENERAL DATA LENGTH.

X_NUCTRACE	DW	?		;RESERVED
X_SYSB		DB  SIZE SYSB_S DUP(?)	;SYSTEM CONTROL BLOCK


;   SYSTEM STATE-TRACKING VARIABLES:

XCSRB		DW	?		;CURRENT SRB
X_ATCB		DW	?		;ACTIVE TASK'S TCB OFFSET
X_TASK_EIPCS	DD	?		;EIP/CS	AT WHICH THE LAST TASK WAS LAST
					;SCHEDULED (REQUIRED BY	DEBUGGER FOR
					;BREAKPOINT CONTROL).
X_TRAP_ADR	DD	?		;SAVED PHYSICAL TRAP POINT ADR.
X_ACT_BPB	DD	?		;ACTUAL BREAK POINT BLOCK OFFSET
X_S_STATE	DD	?		;JUMP POINTER FOR SCHEDULER.
X_INH_LOC	DW	?		;INHIBIT INDICATOR

X_HEAP_ID	DW	?		;CONFIGURED/DEFINED HEAP ID (ONLY DUMMY)
X_TIMEOUT_VALUE	DD	?		;TIMEOUT VALUE
X_ASCTOD	DB	8 DUP (?)	;ASCII TIME OF DAY.
X_INTLEVEL	DW	?		;CURRENT INTERRUPT NESTING LEVEL.
X_3964_DEVICE	DB	?		;FOR 3964 DRIVER
XMONMOD		DB	?		;DEBUGGER MONITOR MODE INDICATOR
X_FREEUCDPTR	DD	?		;POINTER TO FREE UCD FROM XALLOC_UCD
X_FREEUCD	DW	?		;NUMBER OF FREE UCDs IN X_FREEUCDPTR
X_FREEUCB	DW	?		;NUMBER OF FREE UCBs IN X_FREEUCDPTR
X_FREEUCBPTR	DD	?		;POINTER TO FREE UCB FROM XALLOC_UCB
X_TIB_COUNTER	DD	?		;CONSECUTIVE COUNTER FOR TIB ID
XMSS		DW	?
XMSP		DW	?

;X_FLAT_DESC	DW	?		;FLAT MEMORY DESCRIPTOR
X_S_TCB		DB  SMR_SIZE DUP (?)	;FOR DUMMY TCB
					;X_S_TCB MUST LIE BEHIND X_S_TCB
X_S_STK		DW  4 DUP (?)		;STK_EAX, STK_EIP, STK_CS, STK_EFL
X_TIMESTRCT	DB  8 DUP(?)		;USED FOR READING CMOS TIME AT STARTUP
X_C_REP_DEVICE	DW	?	
X_C_REP_UNIT	DW	?	
X_C_REP_TABLE_SIZE DW	?   
X_SRB_Q		DW	?		;SRB QUEUE HEADS.
X_SRB_FREEQ	DW	?		;HEAD OF SRB FREE LIST.
X_SRB_QEND	DW	?		;SRB QUEUE TAILS.
X_SMR_Q		DW	?		;HEAD OF SMR WAIT QUEUE.
X_SMR_I		DW	?		;USED SMR DURING SVC IN I-STATE
X_DYN_JT	DW  MAX_SVC_NUM DUP(?)	;DYNAMIC SVC JUMP TABLE
X_DOS_INTR	DD	?		;ONLY FOR RMOS2
X_DATA_LEN	DW	?		;ONLY FOR RMOS2
X_HOOK_TAB	DD	X_HOOK_TAB_LEN DUP (?)	;HOOKS JUMP TABLE(ONLY RMOS2)

X_RES_VECTORS	DB  32 DUP(?)		;BITFIELD FOR SET OR RESERVED VECTORS
X_TOD_TMB	DB  TMB_SIZE DUP (?)	;TIME OF DAY TMB - DEDICATED.

;   SPECIAL VARIABLES FOR THE DEVICE DRIVERS:
;   WILL BE COPIED IN MONITOR MODE SO DONT CHANGE IT

XCIRB		DW	?		;CURRENT IRB
		DW	?		;SEGMENT
X_CTCB		DW	?		;TCB OFFSET OF TASK WHICH WAS ACTIVE
	 				;WHEN CURRENT SRB WAS CONSTRUCTED.
X_READY_FLAG	DB	?		;READY_FLAG FOR SCHEDULER.
X_TOGGLE	DB	?		;TIEBREAKING TOGGLE FOR SCHEDULER.
X_CSVC		DW	?		;CURRENT SVC NUMBER.
XDCB		DW	?		;CURRENT DCB
		DW	?		;SEGMENT
XUCB		DW	?		;CURRENT UCB
		DW	?		;SEGMENT
XPOINTER	EQU	THIS WORD	;GENERAL PURPOSE POINTER VARIABLE:
XOFFSET		DW	?		;OFFSET,
XSEGMENT	DW	?		;SELECTOR.
XDEVNUM		DB	?		;CURRENT DEVICE NUMBER,
XDEVUNIT	DB	?		;CURRENT UNIT NUMBER.
XTUNIT		DB	?		;TIME-UNIT CODE.
XTNUM		DB	?		;NUMBER OF UNITS
XSTATUS		DD	?		;STATUS TRANSPORT VARIABLE.
XERRMSG		DD	?		;ERROR-MESSAGE TRANSPORT VARIABLE.
XPOOLNUM	DB	?		;POOL NUMBER FOR BLOCK ALLOCATION.
		DB	?		;ADJUST TO EVEN LOCATION
XBLKLEN		DW	?		;LENGTH OF BLOCK NEEDED, BYTES.
XTASK		DW	?		;TASK ID.
XPRIS		DB	?		;PRIORITY SOURCE OPTIONS.
XPRIV		DB	?		;PRIORITY.
XP1		DW	?		;PARAMETER 1.
XP2		DW	?		;PARAMETER 2.
XGRP		DB	?		;GLOGAL EVENT FLAG GROUP ID.
		DB	?		;ADJUST TO EVEN LOCATION
XFLAGS		DD	?		;EVENT FLAG	MASK.
XGENW		DW	?		;GENERAL WORD.
XBOX		DB	?		;LOCAL MAILBOX ID
XGENB		DB	?		;GENERAL BYTE.
XGEND		DD	?		;GENERAL DWORD.
XSEG		DW	?		;SELECTOR FOR S-STATE ROUTINES
XSEGLIM		DD	?		;SEGMENT LIMIT FOR S-STATE ROUTINES
X_DRIVER_SIZE	EQU $-XCIRB		;DRIVER VARIABLE LENGTH.

X_DRIVER_SAVE	DB  X_DRIVER_SIZE DUP (?)

	PUBLIC	X_USER_TABLE_DATA
X_USER_TABLE_DATA	LABEL	DWORD	;START OF USER DATA
		DD	?
USER_NUM_D    EQU ($-X_USER_TABLE_DATA) / (TYPE X_USER_TABLE_DATA)

X_GINIT_SIZE	EQU $ -	X_DATA_START	;INITIALIZATION	LENGTH.
		DD  ?			;DONT REMOVE THIS!!!!

%END_RDATA_SEG

MTOS_DS   SEGMENT PUBLIC 'MTOS_DATA'
MTOS_DS  	  ENDS

MTOS_LRAM SEGMENT PUBLIC
MTOS_LRAM	  ENDS

MTOS_GROM SEGMENT PUBLIC
MTOS_GROM	  ENDS

MTOS_LROM SEGMENT PUBLIC
MTOS_LROM	  ENDS

MTOS_CS SEGMENT PUBLIC 'MTOS_CODE'
MTOS_CS	  ENDS
) FI%'
